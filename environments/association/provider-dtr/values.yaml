digital-twin-registry:
  enableKeycloak: true
  enablePostgres: true
  # Keylcloak configuration
  keycloak:
    type: NodePort
    args: [ "kc.sh import --file /opt/keycloak/data/import/default-realm-import.json; kc.sh start-dev --hostname-strict=false --proxy=edge" ]
    auth:
      adminUser: <path:semantics/data/dtr#keycloak-admin-user>
      adminPassword: <path:semantics/data/dtr#keycloak-admin-password>
    extraVolumes:
      - name: provider-dtr-digital-twin-registry-keycloak-configmap
        configMap:
          name: registry-keycloak-configmap
    extraVolumeMounts:
      - mountPath: /opt/keycloak/data/import/default-realm-import.json
        subPath: default-realm-import.json
        name: provider-dtr-digital-twin-registry-keycloak-configmap
    ingress:
      enabled: true
      hostname: <path:semantics/data/dtr#keycloak-hostname>
      path: /
      tls: true
      annotations:
        external-dns.alpha.kubernetes.io/hostname: <path:semantics/data/dtr#keycloak-hostname>
        nginx.org/location-snippets: |
          add_header X-Forwarded-Proto https;
          add_header X-Forwarded-For <path:semantics/data/dtr#keycloak-hostname>;
  # Postgres configuration
  postgresql:
    primary:
      persistence:
        enabled: true
        size: 8Gi
    service:
      ports:
        postgresql: 5432
    auth:
      username: <path:semantics/data/dtr#db-user>
      password: <path:semantics/data/dtr#db-password>
      database: <path:semantics/data/dtr#db-schema>
  # DTR  configuration
  registry:
    host: <path:semantics/data/dtr#dtr-hostname>
    authentication: true
    idpIssuerUri: <path:semantics/data/dtr#idpIssuerUri>
    idpClientId: <path:semantics/data/dtr#idpClientId>
    tenantId: <path:semantics/data/dtr#tenantId>
    useGranularAccessControl: "false"
    ingress:
      enabled: true
      tls: 
        enabled: true
        secretName: registry-certificate-secret
      className: nginx
      urlPrefix: ""
      rules:
        - host:
          http:
            paths:
              - path: /dtr
                backend:
                  service:
                    name: provider-dtr
                    port:
                      number: 8080
      annotations: 
        kubernetes.io/ingress.class: nginx
        cert-manager.io/cluster-issuer: "letsencrypt-prod"
        nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
        nginx.ingress.kubernetes.io/ssl-passthrough: "true"
